/***********************************************************
Copyright (C) 2004 VeriSign, Inc.

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.Ê See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MAÊ 02111-1307Ê USA

http://www.verisign.com/nds/naming/namestore/techdocs.html
***********************************************************/
package com.verisign.epp.codec.gen;


//----------------------------------------------
//
// imports...
//
//----------------------------------------------
// Log4j Imports
import org.apache.log4j.Logger;

// W3C Imports
import org.w3c.dom.Document;
import org.w3c.dom.Element;

import com.verisign.epp.util.EPPCatFactory;


/**
 * Represents a &lttrID&gt element of a response, which uniquely identifies a
 * transaction.   A transaction identifier SHALL include the following child
 * elements:<br><br>
 * 
 * <ul>
 * <li>
 * An optional &ltclTRID&gt element that mirrors the optional &ltclID&gt
 * element in the command.  Use <code>getClientTransId</code> and
 * <code>setClientTransId</code> to get and set the element.
 * <code>hasClientTransId</code> can be used to determine if the element
 * exists.
 * </li>
 * <li>
 * A &ltsvTRID&gt element that is generated by the EPP Server that uniquely
 * identifies the server transaction.  Use <code>getServerTransId</code> and
 * <code>setServerTransId</code> to get and set the element.
 * </li>
 * </ul>
 * 
 *
 * @author $Author: jim $
 * @version $Revision: 1.4 $
 */
public class EPPTransId implements EPPCodecComponent {
	/** Minimum transaction id length. */
	public final static int MIN_TRANSID_LEN = 3;

	/** Maximum transaction id length. */
	public final static int MAX_TRANSID_LEN = 64;

	/** XML root tag name for <code>EPPTransId</code>. */
	final static String ELM_NAME = "trID";

	/** XML tag name for the clientTransId attribute. */
	private static final String ELM_CLIENT_TRANSID = "clTRID";

	/** XML tag name for the serverTransId attribute. */
	private static final String ELM_SERVER_TRANSID = "svTRID";

	/** Log4j category for logging */
	private static Logger cat =
		Logger.getLogger(
						 EPPTransId.class.getName(),
						 EPPCatFactory.getInstance().getFactory());

	/** Client specified transaction id */
	private String clientTransId;

	/** Server generated transaction id */
	private String serverTransId;

	/**
	 * Root mapping name such as domain or contact (e.g.
	 * <code>domain:trID</code> for domain mapping).  This attribute needs to
	 * be specified before calling encode(Document) method.
	 */
	private String rootName = ELM_NAME;

	/**
	 * XML namespace prefix for the trans id elements.  This is parsed from the
	 * <code>rootName</code> attribute.  For example, if <code>rootName</code>
	 * is  <code>domain:trID</code> than the prefix is set to
	 * <code>domain</code>.
	 */
	private String prefix = null;

	/**
	 * Allocates a new <code>EPPTransId</code> with <code>null</code>  default
	 * attribute values.  The server transaction id must be  set before
	 * calling <code>encode</code>.
	 */
	public EPPTransId() {
		clientTransId     = null;
		serverTransId     = null;
	}

	// End EPPTransId.EPPTransId()

	/**
	 * Allocates a new <code>EPPTransId</code> with just a server transaction
	 * id specified.
	 *
	 * @param aServerTransId Server generated transaction id that uniquely
	 * 		  identifies the transaction.
	 */
	public EPPTransId(String aServerTransId) {
		clientTransId     = null;
		serverTransId     = aServerTransId;
	}

	// End EPPTransId.EPPTransId(String)

	/**
	 * Allocates a new <code>EPPTransId</code> with both the  client
	 * transaction id and the server transaction id specified.
	 *
	 * @param aClientTransId Client specified transaction id contained in  an
	 * 		  EPP command.
	 * @param aServerTransId Server generated transaction id that uniquely
	 * 		  identifies the transaction.
	 */
	public EPPTransId(String aClientTransId, String aServerTransId) {
		clientTransId     = aClientTransId;
		serverTransId     = aServerTransId;
	}

	// End EPPTransId.EPPTransId(String, String)

	/**
	 * Allocates a new <code>EPPTransId</code> with both the  client
	 * transaction id and the server transaction id specified along with a
	 * specific root tag name.
	 *
	 * @param aRootName Root element of trans id.
	 * @param aClientTransId Client specified transaction id contained in  an
	 * 		  EPP command.
	 * @param aServerTransId Server generated transaction id that uniquely
	 * 		  identifies the transaction.
	 */
	public EPPTransId(
					  String aRootName, String aClientTransId,
					  String aServerTransId) {
		this.setRootName(aRootName);
		clientTransId     = aClientTransId;
		serverTransId     = aServerTransId;
	}

	// End EPPTransId.EPPTransId(String, String)

	/**
	 * Gets the root tag such as domain or host specific tags. The default
	 * value is set to <code>ELM_NAME</code>.
	 *
	 * @return The root tag used.
	 */
	public String getRootName() {
		return rootName;
	}

	// End EPPTransId.getRootName()

	/**
	 * Sets the root tag such as domain or host specific tags.
	 *
	 * @param aRootName Sets the root tag
	 */
	public void setRootName(String aRootName) {
		this.rootName = aRootName;

		int colonPos = this.rootName.indexOf(':');

		if (colonPos != -1) {
			this.prefix = this.rootName.substring(0, colonPos);
		}
		else {
			this.prefix = null;
		}
	}

	// End EPPTransId.setRootName()

	/**
	 * Gets the client specified transaction id.
	 *
	 * @return the client specified transaction id <code>String</code> if
	 * 		   defined; <code>null</code> otherwise.
	 */
	public String getClientTransId() {
		return clientTransId;
	}

	// End EPPTransId.getClientTransId()

	/**
	 * Sets the client specified transaction id.
	 *
	 * @param aClientTransId the client specified transaction id.
	 */
	public void setClientTransId(String aClientTransId) {
		clientTransId = aClientTransId;
	}

	// End EPPTransId.setClientTransId(String)

	/**
	 * Gets the server generated transaction id.
	 *
	 * @return the server generated transaction id <code>String</code> if
	 * 		   defined; <code>null</code> otherwise.
	 */
	public String getServerTransId() {
		return serverTransId;
	}

	// End EPPTransId.getServerTransId()

	/**
	 * Sets the server generated transaction id.
	 *
	 * @param aServerTransId the server generated transaction id.
	 */
	public void setServerTransId(String aServerTransId) {
		serverTransId = aServerTransId;
	}

	// End EPPTransId.setServerTransId(String)

	/**
	 * encode <code>EPPTransId</code> into a DOM element tree.  The &lttrID&gt
	 * or the  element name set with <code>setRootName</code> is creates and
	 * the attribute nodes are appended as children.
	 *
	 * @param aDocument DOCUMENT ME!
	 *
	 * @return &lttrID&gt root element tree.
	 *
	 * @exception EPPEncodeException Error encoding the DOM element tree.
	 */
	public Element encode(Document aDocument) throws EPPEncodeException {
		// Check pre-conditions
		if (serverTransId == null) {
			throw new EPPEncodeException("EPPTransId required attribute \"server tranaction id\" is null.");
		}

		if (
			(serverTransId.length() < MIN_TRANSID_LEN)
				|| (serverTransId.length() > MAX_TRANSID_LEN)) {
			throw new EPPEncodeException("EPPTransId server transaction id length of "
										 + serverTransId.length()
										 + "is out of range, must be between "
										 + MIN_TRANSID_LEN + " and "
										 + MAX_TRANSID_LEN);
		}

		if (
			(clientTransId != null)
				&& (
					(clientTransId.length() < MIN_TRANSID_LEN)
					|| (clientTransId.length() > MAX_TRANSID_LEN)
				)) {
			throw new EPPEncodeException("EPPTransId client transaction id length of "
										 + clientTransId.length()
										 + "is out of range, must be between "
										 + MIN_TRANSID_LEN + " and "
										 + MAX_TRANSID_LEN);
		}

		Element root = aDocument.createElement(rootName);

		// Client Transaction Id
		EPPUtil.encodeString(
							 aDocument, root, clientTransId, EPPCodec.NS,
							 ELM_CLIENT_TRANSID);

		// Server Transaction Id
		EPPUtil.encodeString(
							 aDocument, root, serverTransId, EPPCodec.NS,
							 ELM_SERVER_TRANSID);

		return root;
	}

	// End EPPTransId.encode(Document)

	/**
	 * decode <code>EPPTransId</code> from a DOM element tree.  The
	 * <code>aElement</code> argument needs to be the "trID" element, or an
	 * element that conforms to the XML structure of "trID".
	 *
	 * @param aElement The "trID" XML element.
	 *
	 * @exception EPPDecodeException Error decoding the DOM element tree.
	 */
	public void decode(Element aElement) throws EPPDecodeException {
		this.setRootName(aElement.getTagName());

		// Client Transaction Id
		clientTransId =
			EPPUtil.decodeString(aElement, EPPCodec.NS, ELM_CLIENT_TRANSID);

		// Server Transaction Id
		serverTransId =
			EPPUtil.decodeString(aElement, EPPCodec.NS, ELM_SERVER_TRANSID);
	}

	// End EPPTransId.decode(Element)

	/**
	 * implements a deep <code>EPPTransId</code> compare.
	 *
	 * @param aObject <code>EPPTransId</code> instance to compare with
	 *
	 * @return DOCUMENT ME!
	 */
	public boolean equals(Object aObject) {
		if (!(aObject instanceof EPPTransId)) {
			cat.error("EPPTransId.equals(): " + aObject.getClass().getName()
					  + " not EPPTransId instance");

			return false;
		}

		EPPTransId theTransId = (EPPTransId) aObject;

		// Root name
		if (!this.rootName.equals(theTransId.rootName)) {
			cat.error("EPPTransId.equals(): rootName not equal");

			return false;
		}

		// Client Transaction Id
		if (
			!(
					(clientTransId == null) ? (
													theTransId.clientTransId == null
												)
												: clientTransId.equals(theTransId.clientTransId)
				)) {
			cat.error("EPPTransId.equals(): clientTransId not equal");

			return false;
		}

		// Server Transaction Id
		if (
			!(
					(serverTransId == null) ? (
													theTransId.serverTransId == null
												)
												: serverTransId.equals(theTransId.serverTransId)
				)) {
			cat.error("EPPTransId.equals(): serverTransId not equal");

			return false;
		}

		return true;
	}

	// End EPPTransId.equals(Object)

	/**
	 * Clone <code>EPPTransId</code>.
	 *
	 * @return Deep copy clone of <code>EPPTransId</code>
	 *
	 * @exception CloneNotSupportedException standard Object.clone exception
	 */
	public Object clone() throws CloneNotSupportedException {
		EPPTransId clone = null;

		clone = (EPPTransId) super.clone();

		return clone;
	}

	// End EPPTransId.clone()

	/**
	 * Implementation of <code>Object.toString</code>, which will result in an
	 * indented XML <code>String</code> representation of the concrete
	 * <code>EPPCodecComponent</code>.
	 *
	 * @return Indented XML <code>String</code> if successful;
	 * 		   <code>ERROR</code> otherwise.
	 */
	public String toString() {
		return EPPUtil.toString(this);
	}

	// End EPPTransId.toString()
}


// End class EPPTransId
